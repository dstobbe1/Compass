%=========================================================
% 
%=========================================================

function E = Fit3DegSphHarm4z_v1a_Reg(V,INPUT)

%---------------------------------------------
% Get Input
%---------------------------------------------
Im0 = INPUT.Im;
SPHs = INPUT.SPHs;
clear INPUT

%--------------------------------------------
% Profile
%--------------------------------------------
for n = 1:17
    SPHs(:,:,:,n) = SPHs(:,:,:,n)*V(n);
end
Im = sum(SPHs,4);

%--------------------------------------------
% Error Vector
%--------------------------------------------
tE = Im(:) - Im0(:);

%--------------------------------------------
% Remove NaNs
%--------------------------------------------
E = tE(not(isnan(tE)));
%test = 0;
